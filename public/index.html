<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="styles/reset.css" rel="stylesheet">
    <link href="styles/style.css" rel="stylesheet">
    <title>Who is this Pokemon?</title>
    <style>
        body {
            background-image: url("assets/img/c1406a95.png");
            background-repeat: repeat;
        }
    </style>


</head>

<body>
    <canvas id="canvas"></canvas>


    <script>
        document.body.style.overflow = 'hidden';
        var canvas = document.getElementById("canvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        var context = canvas.getContext("2d"),
            img = new Image();

        var indexPokemon = getRandom(1, 150);

        selectPokemon(indexPokemon).then((pokemon) => {

            drawPokemon(`assets/img/pokemons/${pokemon.id}.png`, canvas, context, true);

            gelAllPokemonsNames().then((allNames) => {
                createOptions(pokemon, allNames)
            })

        });

        async function gelAllPokemonsNames() {
            let result = await fetch('https://pokeapi.co/api/v2/pokemon/');
            let pokemons = await result.json();

            return pokemons.results.map(x => x.name)
        }

        async function selectPokemon(indexPokemon) {
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${indexPokemon}/`);
            const pokemon = await response.json();

            return pokemon;
        }

        function getRandom(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function drawPokemon(imageUrl, canvas, ctx, doSilhouette) {
            var image = new Image();
            image.src = imageUrl;

            image.onload = function () {

                var newImgWidth = 290;
                var newImgHeight = image.height * (newImgWidth / image.width);

                var imgX = canvas.width / 2 - newImgWidth / 2;
                var imgY = (canvas.height / 2 - newImgHeight / 2) - 30;

                ctx.drawImage(image, imgX, imgY,
                    newImgWidth, newImgHeight
                );

                if (!doSilhouette) return;

                var rawImage = ctx.getImageData(imgX, imgY, newImgWidth, newImgHeight);

                for (var i = 0; i < rawImage.data.length; i += 4) {
                    if (rawImage.data[i + 3] >= 100) {
                        rawImage.data[i] = 30;
                        rawImage.data[i + 1] = 30;
                        rawImage.data[i + 2] = 30;
                        rawImage.data[i + 3] = 255;
                    } else {
                        rawImage.data[i + 3] = 0;
                    }
                }

                ctx.putImageData(rawImage, imgX, imgY);


            };
        }

        function createOptions(pokemon, allNames) {
            let others = allNames.filter(x => x != pokemon.name);

            let index1 = getRandom(0, allNames.length);
            let index2 = getRandom(0, allNames.length);

            while (index1 == index2) {
                index2 = getRandom(0, allNames.length);
            }

            var options = [allNames[index1], allNames[index2], pokemon.name];

            var shuffledOptions = shuffle(options);
        }

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            while (0 !== currentIndex) {

                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

    </script>
</body>

</html>